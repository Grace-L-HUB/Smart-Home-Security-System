# 智能家居安防系统

## 项目简介

基于STM32F103C8T6的智能家居安防系统，具备环境监测、入侵检测、模式切换、报警提示等功能，支持OLED显示和串口控制。

## 功能特点

- 🌡️ **环境监测**：DHT11温湿度传感器实时监测
- 🔍 **入侵检测**：HC-SR501红外传感器检测人体活动
- 🎯 **模式切换**：三种系统模式（布防/居家/调试）
- 🔊 **报警提示**：蜂鸣器报警和状态提示
- 📺 **OLED显示**：0.96寸OLED实时显示系统状态
- 🎛️ **编码器控制**：EC11编码器实现模式切换
- 💾 **数据存储**：W25Q64存储系统记录
- ⏰ **实时时钟**：DS1302提供时间管理
- 💻 **串口通信**：支持命令控制和数据传输

## 硬件要求

| 组件 | 型号 | 数量 |
|------|------|------|
| 微控制器 | STM32F103C8T6 | 1 |
| 温湿度传感器 | DHT11 | 1 |
| 红外传感器 | HC-SR501 | 1 |
| 显示屏 | 0.96寸OLED | 1 |
| 编码器 | EC11 | 1 |
| 蜂鸣器 | 无源蜂鸣器 | 1 |
| 存储芯片 | W25Q64 | 1 |
| 实时时钟 | DS1302 | 1 |
| USB转TTL | CH340 | 1 |

## 软件要求

- Keil MDK-ARM 5.x
- STM32F10x固件库
- 串口调试助手（如SecureCRT、Xshell）

## 项目结构

```
├── Core/            # 核心固件库
├── Drivers/         # 硬件驱动
├── Hardware/        # 硬件模块
│   ├── Buzzer.c/.h  # 蜂鸣器驱动
│   ├── DHT11.c/.h   # 温湿度传感器驱动
│   ├── Encoder.c/.h # 编码器驱动
│   ├── IR.c/.h      # 红外传感器驱动
│   ├── OLED.c/.h    # OLED驱动
│   ├── RTC.c/.h     # 实时时钟驱动
│   ├── Serial.c/.h  # 串口通信驱动
│   └── W25Q64.c/.h  # 存储芯片驱动
├── User/            # 用户代码
│   ├── main.c       # 主程序
│   └── ...          # 其他用户文件
└── 智能家居安防系统开发文档.md # 详细开发文档
```

## 快速开始

### 1. 硬件连接

按照硬件连接图连接各组件：
- STM32F103C8T6作为核心控制器
- 传感器和执行器连接到相应GPIO引脚
- OLED通过I2C接口连接
- W25Q64通过SPI接口连接
- DS1302实时时钟连接到PC13-PC15

### 2. 编译烧录

1. 打开Keil MDK-ARM工程
2. 编译项目（Ctrl+F7）
3. 使用ST-Link或串口下载程序

### 3. 运行系统

1. 连接USB转TTL到电脑
2. 打开串口调试助手（波特率115200）
3. 系统启动后自动进入布防模式
4. 使用编码器或串口命令控制系统

## 使用说明

### 系统模式

- **布防模式（MODE_ARMED）**：红外触发立即报警
- **居家模式（MODE_HOME）**：红外触发仅记录，不报警
- **调试模式（MODE_DEBUG）**：无报警功能，用于调试

### 控制方式

#### 编码器控制
- **旋转**：顺时针下一个模式，逆时针上一个模式
- **按键**：按固定顺序循环切换模式

#### 串口命令

```
help - 显示帮助信息
mode <0-2> - 切换系统模式 (0:布防, 1:居家, 2:调试)
status - 显示系统状态
reset - 重置系统
threshold temp <low> <high> - 设置温度阈值
threshold humi <low> <high> - 设置湿度阈值
history [count] - 查看历史记录
export - 导出CSV格式数据
clear_history - 清除历史数据
time - 显示当前时间
time <YY> <MM> <DD> <HH> <mm> <SS> - 设置时间
```

## 系统初始化

系统启动后，自动完成以下初始化：
1. 硬件模块初始化
2. 读取存储的配置信息
3. 设置默认系统模式为布防
4. 启动实时时钟

## 注意事项

1. 确保硬件连接正确，避免短路
2. 首次使用时，建议设置正确的时间
3. 定期清理历史记录，避免存储空间不足
4. 调试模式下，报警功能将被禁用

## 开发文档

详细的开发文档请参考：[智能家居安防系统开发文档.md](智能家居安防系统开发文档.md)

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，欢迎交流讨论。